name: Fast Element benchmark jobs

on: [pull_request]

jobs:
    setup:
        name: Setup Tachometer Reporting
        runs-on: ubuntu-latest
        steps:
            - name: Initialize tachometer comment
              uses: andrewiggins/tachometer-reporter-action@v2
              with:
                  initialize: true
            - uses: actions/checkout@v2
              with:
                  fetch-depth: 0
            - name: Get yarn cache directory path
              id: yarn-cache-dir-path
              run: echo '::set-output name=dir::$(yarn cache dir)'

            - name: Set up node_modules cache
              uses: actions/cache@v2
              id: yarn-cache
              with:
                  path: |
                      ${{ steps.yarn-cache-dir-path.outputs.dir }}
                      node_modules
                      */*/node_modules
                  key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
                  restore-keys: |
                      ${{ runner.os }}-yarn-
            - name: Install package dependencies
              run: yarn install --frozen-lockfile --ignore-scripts --prefer-offline
            - name: Prepare workspaces
              run: yarn prepare

            - name: Benchmark local create10k
              run: |
                cd packages/utilities/fast-benchmarks
                yarn run benchmark:fast-element:test:local

            - name: Report localTest-create10k
              uses: andrewiggins/tachometer-reporter-action@v2
              with:
                report-id: localTest-create10k
                path: packages/utilities/fast-benchmarks/results/fast-element_localTest-create10k.config.json
                pr-bench-name: users/wendy/local-build-actions
                base-bench-name: master
            # - uses: actions/upload-artifact@v3
            #   with:
            #       name: Upload results folder
            #       path: packages/utilities/fast-benchmarks/results/fast-element_test-update10th.json
            # - name: Report Tachometer Result
            #   uses: andrewiggins/tachometer-reporter-action@v2
            #   with:
            #       report-id: results
            #       path: packages/utilities/fast-benchmarks/results/fast-element_test-update10th.json

            # - uses: actions/upload-artifact@v3
            #   with:
            #       name: Upload results folder
            #       path: packages/utilities/fast-benchmarks/results/fast-element_localTest-create10k.json
            # - name: Report Tachometer Result
            #   uses: andrewiggins/tachometer-reporter-action@v2
            #   with:
            #       report-id: results-create-local
            #       path: packages/utilities/fast-benchmarks/results/fast-element_localTest-create10k.json
